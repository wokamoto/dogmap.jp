/* Released under the GPL license (http://www.gnu.org/copyleft/gpl.html) @example http://dogmap.jp/lightpop_sample/ */
(function(a){a.fn.lightpop=function(O,B,z,f,g,t){document._write=document.write;z=z||"lightpop";f=f||"images/";g=g||f+z+"-";t=t||f+"icon-";O=a.extend(true,{overlayBgColor:"#000",overlayOpacity:0.7,contentFrameType:"border",contentBorder:"none",boxBorderSize:6,containerBorderSize:10,containerResizeSpeed:"normal",contentBgColor:"#FFF",imageBox:g+"box.gif",imageBorderL:g+"border-l.gif",imageBorderR:g+"border-r.gif",imageLoading:g+"ico-loading.gif",imageBtnPrev:g+"btn-prev.gif",imageBtnNext:g+"btn-next.gif",imageBtnClose:g+"btn-close.gif",imageBlank:g+"blank.gif",imageBtnPrevWidth:63,imageBtnNextWidth:63,imageBtnCloseWidth:66,txtImage:null,txtOf:"of",setLinkToTitle:false,keyToClose:"c",keyToPrev:"p",keyToNext:"n",filter:"a,area",flvplayer:"flvplayer.swf",iconAdd:true,detailsEnabled:true,initSize:250,defaultLater:1500,grouping:true,Image:{enabled:true,icon:t+"image.png",param:{},size:[0,0]},Contents:{enabled:true,icon:t+"contents.png",param:{},size:[0,0],iframeEnabled:true,scrolling:"no",style:"border:solid 1px #CCC;"},Video:{enabled:true,icon:t+"video.png",param:{},size:[320,240]},YouTube:{enabled:true,icon:t+"youtube.png",param:{hl:"ja"},size:[425,355]},Metacafe:{enabled:true,icon:t+"metacafe.png",param:{},size:[400,345]},LiveLeak:{enabled:true,icon:t+"liveleak.png",param:{},size:[450,370]},GoogleVideo:{enabled:true,icon:t+"googlevideo.png",param:{hl:"ja"},size:[400,326]},Dailymotion:{enabled:true,icon:t+"dailymotion.png",param:{},size:[420,330]},superdeluxe:{enabled:true,icon:t+"superdeluxe.png",param:{},size:[400,350]},nicovideo:{enabled:true,icon:t+"nicovideo.png",param:{},size:[485,385]}},O);if(O.imageMaxWidth||O.imageMaxHeight){O=a.extend(true,O,{Image:{size:[(O.imageMaxWidth||0),(O.imageMaxHeight||0)]}})}var i=/^border$/i.test(O.contentFrameType);var H=[];var S=document,G=window;var T=S.body,Q=S.documentElement,k=S.images;var l=a.browser.msie,F=a.browser.mozilla,C=a.browser.opera,m=a.browser.safari;var E=a.support.boxModel;B=a.extend(true,{Image:{match:function(b){return(O.Image.enabled&&/\.(jpe?g|gif|png|bmp)$/i.test(b))},defaultSize:O.Image.size,set:function(b){x(b,true)},preload:function(b){x(b,false)}},Video:{match:function(b){return(O.Video.enabled&&/\.(flv|swf|rm|mov|3gp|mp4|asf|avi|mpg|wmv)$/i.test(b))},defaultSize:O.Video.size,getInfo:function(Z,W,aa,ab,d,Y){Y=Y||Z.replace(/\?.*$/,"");var X={};var ac="true";var e=false;var b={rm:{id:"CFCDAA03-8BE4-11CF-B84B-0020AFBBCCFA",type:"audio/x-pn-realaudio-plugin"},mp4:{id:"02BF25D5-8C17-4B23-BC80-D3488ABDDC6B",type:"video/quicktime",url:"http://www.apple.com/qtactivex/qtplugin.cab"},wmv:{id:"6BF52A52-394A-11d3-B153-00C04F79FAA6",type:"application/x-oleobject",url:"http://www.microsoft.com/windows/windowsmedia"}};var w=Y.toLowerCase().match(/\.(flv|swf|rm|mov|3gp|mp4|asf|avi|mpg|wmv)$/i)[1];switch(w){case"flv":aa+=22;X={flashvars:"movieURL="+Y+"&autoStart="+ac};Y=O.flvplayer+"?file="+Y;case"swf":X=a.extend(true,X,{quality:"high",bgcolor:"#000"});Y=v(Y,W,aa,X);break;case"rm":X={autostart:ac,controls:"imagewindow,controlpanel"};Y=c(Y,b.rm.id,b.rm.type,W,aa,X,"","",e,true);break;case"mov":case"mp4":case"3gp":aa+=20;X={href:Y,controller:"true",pluginspage:"http://www.apple.com/quicktime/download/",autoplay:ac,bgcolor:"000000"};Y=c(Y,b.mp4.id,b.mp4.type,W,aa,X,' codebase="'+b.mp4.url+'"',"",e,true);break;case"wmv":default:aa+=20;if(w=="wmv"){X={URL:Y,AutoStart:ac,uiMode:"full"};e='src="'+Y+'" name="player" width="'+W+'" height="'+aa+'" type="'+b.wmv.type+'" pluginurl="'+b.wmv.url+'" allowchangedisplaysize="1" autosize="1" displaysize="1" showcontrols="1" showstatusbar="0" autorewind="1" autostart="'+(ac=="false"?"0":"1")+'"'}else{X={href:Y,autostart:ac,uiMode:"full"}}Y=c(Y,b.wmv.id,b.wmv.type,W,aa,X,"","",e,false);break}return{content:Y,width:W,height:aa,later:Math.round(O.defaultLater*2/3)}}},YouTube:{match:function(b){return(O.YouTube.enabled&&/\.youtube\.com\/watch/i.test(b))},base:"www.youtube.com/v/",defaultSize:O.YouTube.size,getInfo:function(W,d,X,Y,b,Z,w){Z=Z||W.replace(/^.*\?v=(.*)$/i,"$1");w=w||b.base+Z;var e={allowFullScreen:"true"};for(var aa in Y){if(/^fmt$/i.test(aa)){w+="&ap=%2526fmt%3D"+Y[aa]}else{w+="&"+aa+"="+Y[aa];if(!/^hl$/i.test(aa)){e[aa]=Y[aa]}if(!/^fs$/i.test(aa)){e.allowFullScreen=(Y[aa]=="1"?"true":"false")}}}w=v(w,d,X,e);return{content:w,width:d,height:X,later:O.defaultLater}}},Metacafe:{match:function(b){return(O.Metacafe.enabled&&/\.metacafe\.com\/watch/i.test(b))},base:"www.metacafe.com/fplayer/",defaultSize:O.Metacafe.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\/watch\/([\d]+\/[^\/]*)\/?.*$/i,"$1");w=w||W.base+b+".swf";var d={};w=v(w,X,e,d,Z);return{content:w,width:X,height:e,later:O.defaultLater}}},LiveLeak:{match:function(b){return(O.LiveLeak.enabled&&/\.liveleak\.com\/view/i.test(b))},base:"www.liveleak.com/player.swf?autostart=false&amp;token=",defaultSize:O.LiveLeak.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\?i=(.*)$/i,"$1");w=w||W.base+b;var d={quality:"high"};w=v(w,X,e,d,Z);return{content:w,width:X,height:e,later:O.defaultLater}}},GoogleVideo:{match:function(b){return(O.GoogleVideo.enabled&&/video\.google\.com\/videoplay/i.test(b))},base:"video.google.com/googleplayer.swf?docId=",defaultSize:O.GoogleVideo.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\?docid=([a-z\d\-]+).*$/i,"$1");w=w||W.base+b;var d={flashvars:""};w=v(w,X,e,d,Z);return{content:w,width:X,height:e,later:O.defaultLater}}},Dailymotion:{match:function(b){return(O.Dailymotion.enabled&&/\.dailymotion\.com\/video/i.test(b))},base:"www.dailymotion.com/swf/",defaultSize:O.Dailymotion.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\/video\/([^_]*).*$/i,"$1");w=w||W.base+b;var d={allowFullScreen:"true",allowScriptAccess:"always"};w=v(w,X,e,d,Z);return{content:w,width:X,height:e,later:O.defaultLater}}},superdeluxe:{match:function(b){return(O.superdeluxe.enabled&&/\.superdeluxe\.com\/sd/i.test(b))},base:"i.cdn.turner.com/sdx/static/swf/share_vidplayer.swf",defaultSize:O.superdeluxe.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\?id=(.*)$/i,"$1");w=w||W.base;var d={allowFullScreen:"true",FlashVars:"id="+b};w=v(w,X,e,d,Z);return{content:w,width:X,height:e,later:O.defaultLater}}},nicovideo:{match:function(b){return(O.nicovideo.enabled&&/\.nicovideo\.jp\/watch/i.test(b))},base:"www.nicovideo.jp/watch/",defaultSize:O.nicovideo.size,getInfo:function(Y,X,e,Z,W,b,w){b=b||Y.replace(/^.*\/watch\/(.*)$/i,"$1");w=w||W.base+b;w='<iframe width="'+X+'" height="'+e+'" src="http://www.nicovideo.jp/thumb/'+b+'" scrolling="no" style="border:solid 1px #CCC;" frameborder="0"><a href="'+w+'">'+W.tytle+"</iframe>";var d=[];document.write=function(aa){d.push(aa)};a.getScript("http://ext.nicovideo.jp/thumb_watch/"+b,function(){W.content=d.join("");a("#lightpop-content").html(W.content);d=[];document.write=document._write});return{content:w,width:X,height:e,later:Math.round(O.defaultLater/3)}}},Contents:{match:function(b){return(O.Contents.enabled&&RegExp(G.location.host,"i").test(b)&&!/\.(jpe?g|gif|png|bmp)$/i.test(b))},defaultSize:O.Contents.size,set:function(e,b){var w=q(H[e].href,O.Contents.size);var d='width="'+w[0]+'" height="'+w[1]+'"';if(O.Contents.iframeEnabled){b="<iframe "+d+' src="'+H[e].href+'" scrolling="'+O.Contents.scrolling+'" style="'+O.Contents.style+'" frameborder="0"><a href="'+H[e].href+'">'+H[e].tytle+"</a></iframe>";H[e]=a.extend(H[e],{content:b,width:w[0],height:w[1],later:500});N(e)}else{a.get(H[e].href,function(X,W){b="<div "+d+">"+X.replace(/[\r\n]/g,"").replace(/.*<body.*?>(.*?)<\/body>.*$/,"$1").replace(/<script.*?>.*<\/script>/g,"")+"</div>";H[e]=a.extend(H[e],{content:b,width:w[0],height:w[1],later:500});N(e)})}},preload:function(b){},content_css:{"text-align":"left","line-height":"1.2em"}}},B);var j={overlay:"overlay",lightpop:z,box:z+"-box",inner:z+"-box-inner",content:z+"-content",nav:z+"-nav",next:z+"-nav-prev",prev:z+"-nav-next",data:z+"-data",wrap:z+"-data-wrap",close:z+"-data-close",details:z+"-details",caption:z+"-details-caption",number:z+"-details-number",loading:z+"-loading"},P={};for(var r in j){P[r]="#"+j[r]}var L=function(b,e){V(O.imageBtnPrev,function(w){O.imageBtnPrevWidth=(w.width>0?w.width:O.imageBtnPrevWidth);V(O.imageBtnNext,function(W){O.imageBtnNextWidth=(W.width>0?W.width:O.imageBtnNextWidth);V(O.imageBtnClose,function(X){O.imageBtnCloseWidth=(X.width>0?X.width:O.imageBtnCloseWidth);if(!i){V(O.imageBox,function(Y){V(O.imageBorderL,function(Z){V(O.imageBorderR,function(aa){O.contentBorder="none"})})})}})})});e=e||[];var d=0;b.filter(O.filter).each(function(){var w=G.location;var Z=a(this);if(!/^https?:/i.test(Z.attr("href"))&&/^https?:/i.test(w.protocol)){Z.attr("href",(/^\//i.test(Z.attr("href"))?w.protocol+"//"+w.hostname+"/"+Z.attr("href"):w.href.replace(/^(.*\/).*$/i,"$1")+Z.attr("href").replace(/^\/?(.*)$/i,"$1")))}for(var X in B){var W=B[X];if(W.match(Z.attr("href").replace(/\?.*$/,""))){var Y=O[X];if(O.iconAdd&&Z.children("img").length===0){Z.css({background:"transparent url("+Y.icon+") no-repeat scroll 1px 0pt",paddingLeft:"20px"})}H.push({type:X,href:Z.attr("href"),title:Z.attr("title")||Z.html().replace(/<[^>]*>/ig,""),base:(W.base?"http://"+W.base:"/")});Z.unbind("click").click((function(aa){return function(){u(aa);return false}})(d));e.push(this);d++;break}}});return new a(e)};var u=function(Z,Y,w,X,e){O.grouping=(H.length>1?O.grouping:false);h(a("embed, object, select"),false);Y=Y||'<div id="'+j.content+'-wrap"><div id="'+j.content+'" /></div>';w=w||(O.detailsEnabled?'<div id="'+j.wrap+'"><div id="'+j.data+'"><div id="'+j.details+'"><div id="'+j.caption+'" /><div id="'+j.number+'" /></div><div id="'+j.data+'-nav"><a href="#" id="'+j.close+'"><img src="'+O.imageBtnClose+'" /></a></div></div></div>':"");X=X||'<div id="'+j.nav+'"><a href="#" id="'+j.prev+'" /><a href="#" id="'+j.next+'" /></div><div id="'+j.loading+'"><a href="#" id="'+j.loading+'-link"><img src="'+O.imageLoading+'" /></a></div>';e=e||'<div id="'+j.overlay+'" /><div id="'+j.lightpop+'"><div id="'+j.box+'"><div id="'+j.inner+'">'+(i?Y+"</div>"+w:'<div id="'+j.box+'-hd"><div id="'+j.box+'-hdc" /></div><div id="'+j.box+'-bd"><div id="'+j.box+'-bdc">'+Y+w+'</div></div><div id="'+j.box+'-ft"><div id="'+j.box+'-ftc" /></div></div>')+X+"</div></div>";a("body").children(":first").before(a(e).hide());var aa=K();var b=M();var d=O.containerBorderSize;a(P.overlay+","+P.lightpop+","+P.nav+","+P.loading).css({position:"absolute"});a(P.box+","+P.data).css({position:"relative"});var ab=D(aa,b);a(P.overlay).css({top:0,left:0,backgroundColor:O.overlayBgColor,opacity:O.overlayOpacity,width:aa.page.width,height:aa.page.height,zIndex:90});a(P.lightpop).css({width:"100%",height:0,top:ab.top,left:ab.left,overflow:"visible","text-align":"center","line-height":0,border:"none",zIndex:100});a(P.lightpop+" a img").css({border:"none"});a(P.box).css({width:O.initSize,height:O.initSize,top:0,margin:"0 auto",padding:0,backgroundColor:O.contentBgColor,border:O.contentBorder,overflow:(i?"hidden":"visible")});a(P.inner).css({width:O.initSize,height:O.initSize,backgroundColor:"transparent",margin:"0 auto",padding:(i?d:0),overflow:(i?"hidden":"visible")});a(P.content+"-wrap").css({backgroundColor:"transparent"});a(P.content).css({margin:(i?0:"0 auto"),padding:(i?0:d+"px 0"),zIndex:110});if(!i){var W=O.boxBorderSize;y(false).css({position:"relative"}).hide();a(P.box+"-hd,"+P.box+"-hdc").css({height:W,top:0});a(P.box+"-ft,"+P.box+"-ftc").css({height:W,bottom:0});a(P.box+"-hd,"+P.box+"-ft").css({margin:"0 "+W+"px 0 0"});a(P.box+"-hdc,"+P.box+"-ftc").css({margin:"0 "+W*-1+"px 0 "+W+"px"})}a(P.nav).css({top:0,left:0,height:"10px",width:"100%",padding:0,margin:(i?"0":O.boxBorderSize+"px")+" auto",zIndex:10});a(P.nav+" a").css({display:"block",height:"100%",zoom:1,margin:(i?0:"0 "+O.boxBorderSize+"px"),outline:"none"});if(O.grouping){a(P.prev).css({width:O.imageBtnPrevWidth,left:0,"float":"left"});a(P.next).css({width:O.imageBtnNextWidth,right:0,"float":"right"})}else{a(P.prev+","+P.next).css({display:"none"})}a(P.loading).css({top:"40%",left:0,height:"20%",width:"100%",margin:"0 auto","text-align":"center","line-height":0});if(O.detailsEnabled){a(P.wrap).css({font:"10px Verdana, Helvetica, sans-serif",backgroundColor:O.contentBgColor,"line-height":"1.4em",width:"100%",margin:"0 auto",padding:"0 "+d+"px 0",overflow:"hidden"}).hide();a(P.data).css({padding:"0 "+d+"px",color:"#666",left:0,bottom:0});a(P.details).css({width:"70%","float":"left","text-align":"left"});a(P.caption).css({"float":"left","font-weight":"bold",width:"100%"});a(P.number).css({"float":"left",clear:"left",width:"100%","padding-bottom":"1em"});a(P.close).css({"float":"right",width:O.imageBtnCloseWidth,padding:".35em 0"})}a(P.overlay).fadeIn(O.containerResizeSpeed,function(){a(P.lightpop).show()});a(P.overlay+","+P.loading+"-link,"+P.close).click(function(){A();return false});U(true);p(Z)};var p=function(b){h(a(P.data+","+P.details+","+P.caption+","+P.number+","+P.close),false);a(P.nav+","+P.prev+","+P.next).hide();a(P.content).hide().children().remove();a(P.loading+","+P.box+","+P.inner).show();y(false);if(O.detailsEnabled&&!i&&m){a(P.wrap).height("auto")}N(b)};var N=function(b){(H[b].content?function(d){a(P.content).append(a(H[d].content));setTimeout(function(){R(d)},H[d].later)}:(B[H[b].type].set?B[H[b].type].set:(function(d){n(d);N(d)})))(b)};var J=function(e,d,b,w){if(O.detailsEnabled){w=(w<28?28:w);b+=w}(i?(function(W){a(P.box).animate({width:d,height:b},"fast",function(){h(W,true)})}):(function(W){if(O.detailsEnabled&&m){a(P.wrap).height(w)}h(W,true)}))(e)};var R=function(Z){var w=O.containerBorderSize,Y=O.boxBorderSize,d=H[Z],b=K(),X=M();var W=d.width+(w+(i?0:Y))*2,e=d.height+w*2;a(P.lightpop).animate(D(b,X),O.containerResizeSpeed,function(){a(P.box).animate({width:W,height:e},O.containerResizeSpeed,function(){var aa=B[d.type];a(P.inner).css({width:(i?d.width:W),height:d.height});a(P.content).css({width:d.width,height:d.height});if(O.detailsEnabled){a(P.wrap).css({width:d.width})}if(aa.content_css){a(P.content).children().css(aa.content_css)}a(P.loading).hide();if(/<object.*>/i.test(d.content)){a(P.content).show()}else{a(P.content).fadeIn()}a(P.overlay).css(b.page);y(true);a(P.caption).html((O.setLinkToTitle?'<a href="'+d.href+'" title="'+d.title+'">'+d.title+"</a>":d.title));a(P.number).html((O.txtImage||d.type)+(O.grouping&&H.length>1?" "+(Z+1)+" "+O.txtOf+" "+H.length:""));var ab=h(a(P.data+","+P.details+","+P.caption+","+P.number+","+P.close),false).show();(O.detailsEnabled?function(ae,ac,ad){a(P.wrap).slideDown("fast",function(){J(ae,ac,ad,(!m?a(this).height():this.scrollHeight))})}:function(ae,ac,ad){J(ae,ac,ad)})(ab,W,e);a(P.nav).css({width:W}).show(function(){if(O.grouping){a(P.prev+","+P.next).css({height:Math.round(e/3),background:"transparent url("+O.imageBlank+") no-repeat"}).unbind();if(Z!=0){a(P.prev).hover(function(){a(this).css({background:"url("+O.imageBtnPrev+") left 30% no-repeat"})},function(){a(this).css({background:"transparent url("+O.imageBlank+") no-repeat"})}).show().click((function(ac){return function(){p(ac);return false}})(Z-1))}if(Z!=(H.length-1)){a(P.next).hover(function(){a(this).css({background:"url("+O.imageBtnNext+") right 30% no-repeat"})},function(){a(this).css({background:"transparent url("+O.imageBlank+") no-repeat"})}).show().click((function(ac){return function(){p(ac);return false}})(Z+1))}}I(true,Z)});if(H.length-1>Z){o(Z+1)}if(Z>0){o(Z-1)}})})};var o=function(b){if(!H[b].content){(B[H[b].type].preload?B[H[b].type].preload:(function(d){n(d)}))(b)}};var q=function(e,d,Y){var X=0,b=0;var W=e.toLowerCase().replace(/[\r\n]/g,"").replace(/["']/g,"").match(/(width|height)=(\d+)/ig);if(W){a.each(W,function(){if(/^width=\d+$/i.test(this)){X=Number(this.replace(/^width=(\d+)$/,"$1"))}if(/^height=\d+$/i.test(this)){b=Number(this.replace(/^height=(\d+)$/,"$1"))}})}if(X===0||b===0){if(d){X=d[0];b=d[1]}else{var w=K();X=w.page.width/4;b=w.page.height/4}}if(Y){if(Y[0]!=0&&X>Y[0]){b=b*(Y[0]/X);X=Y[0]}if(Y[1]!=0&&b>Y[1]){X=X*(Y[1]/b);b=Y[1]}}return[Math.round(X),Math.round(b)]};var n=function(aa,Z,W){var d,Y={},e=H[aa];var b=O[e.type],w=B[e.type],X=e.href.replace(/&.*$/i,"");if(/\?.*$/.test(e.href)){var ab=e.href.replace(/^.*\?/,"").split("&");if(ab.length>0){a.each(ab,function(){var ad,ac=this.toString();if(!/^(width|height|v|i|docid|id)\=.*$/i.test(ac)){ad=(ac).match(/^([^=]*)=(.*)$/i);if(ad.length>2){Y[ad[1]]=ad[2]}}})}}Y=a.extend(Y,b.param);d=q(e.href,w.defaultSize);H[aa]=a.extend(e,w.getInfo(X,d[0],d[1],Y,e))};var v=function(d,W,b,Y,X,w){if(typeof X==="object"){a.each(X,function(Z){d+=(d.indexOf(Z+"=")<0?(d.indexOf("?")<0?"?":"&")+Z+"="+this:"")})}var e={movie:d,wmode:"transparent"};Y=(Y?a.extend(e,Y):e);w=w||'<object width="'+W+'" height="'+b+'" data="'+d+'" wmode="'+Y.wmode+'" type="application/x-shockwave-flash">';a.each(Y,function(Z){w+='<param name="'+Z+'" value="'+this+'" />'});w+="</object>";return w};var c=function(d,X,ac,e,ad,W,ae,b,ab,aa){var Z="",w="",Y={src:d,width:e,height:ad,type:ac};W=(W?a.extend(Y,W):Y);Z+='<object width="'+e+'" height="'+ad+'"'+(X!=" "?'classid="clsid:'+X+'"':"")+' type="'+ac+'" '+b+">";a.each(W,function(af){Z+='<param name="'+af+'" value="'+this+'" />'});w+="<embed "+(ab!==false?ab:'width="'+e+'" height="'+ad+'"');if(ab===false){a.each(W,function(af){w+=" "+af+'="'+this+'"'})}w+=">"+(aa?'<noembed><a href="'+d+'">'+d+"</a></noembed>":"")+"</embed>";Z+=w+"</object>";return Z};var y=function(w){if(!i){var e=a(P.box+"-hd, "+P.box+"-hdc, "+P.box+"-bd, "+P.box+"-bdc, "+P.box+"-ft, "+P.box+"-ftc"),d="transparent",b=d+" url("+O.imageBox+")",W=O.contentBgColor;if(w){a(P.box).css({backgroundColor:d});a(P.box+"-hd").css({background:b+" left top no-repeat"});a(P.box+"-hdc").css({background:b+" right top no-repeat"});a(P.box+"-bd").css({background:W+" url("+O.imageBorderL+") left top repeat-y"});a(P.box+"-bdc").css({background:d+" url("+O.imageBorderR+") right top repeat-y"});a(P.box+"-ft").css({background:b+" left bottom no-repeat"});a(P.box+"-ftc").css({background:b+" right bottom no-repeat"});e.show()}else{a(P.box).css({backgroundColor:W});e.css({background:d})}return e}};var s=function(X){var b=X.width,d=X.height;if(typeof X.naturalWidth!=="undefined"){b=X.naturalWidth;d=X.naturalHeight}else{if(typeof X.runtimeStyle!=="undefined"){var W=X.runtimeStyle;var e={w:W.width,h:W.height};W.width="auto";W.height="auto";b=X.width;d=X.height;W.width=e.w;W.height=e.h}else{var e={w:X.width,h:X.height};X.removeAttribute("width");X.removeAttribute("height");b=X.width;d=X.height;X.width=e.w;X.height=e.h}}return{width:b,height:d,src:X.src}};var x=function(d,b){V(H[d].href,(function(w,e){return function(W){var X=q(W.src,[W.width,W.height],O.Image.size);H[w]=a.extend(H[w],{content:'<img src="'+W.src.replace(/\?.*$/,"")+'" width="'+X[0]+'" height="'+X[1]+'" />',width:X[0],height:X[1],later:(l?250:100)});if(e){N(w)}}})(d,b))};var V=function(b,Z,X,e,aa){Z=Z||function(){};X=X||function(){};e=e||10;aa=aa||2000;for(var d=0,Y=k.length;d<Y;++d){if(k[d].src===b&&k[d].complete){Z(s(k[d]));return}}var w=new Image(),W=0;w.finish=false;w.onabort=w.onerror=function(){if(w.finish){return}w.finish=true;X(b)};w.onload=function(){w.finish=true;if(C&&!w.complete){X(b);return}Z(s(w))};w.src=b;if(!w.finish&&aa){setTimeout(function(){if(w.finish){return}if(w.complete){w.finish=true;if(w.width){return}X(b);return}if((W+=e)>aa){w.finish=true;X(b);return}setTimeout(arguments.callee,e)},0)}};var h=function(d,b){return d.css({visibility:(b?"visible":"hidden")})};var I=function(b,d){a(S).unbind("keydown");if(b){a(S).keydown(function(w){var e=(w||event).keyCode;var W=String.fromCharCode(e).toLowerCase();if(W==O.keyToClose){A()}else{if(O.grouping){if(W==O.keyToPrev&&d!=0){p(d-1)}else{if(W==O.keyToNext&&d!=(H.length-1)){p(d+1)}}}}})}};var D=function(b,d){b=b||K();d=d||M();var e={top:d.top+Math.round(b.window.height/10),left:d.left};var w=(typeof a.fn.lightpop.position!="undefined"?a.fn.lightpop.position:e);return({top:typeof w.top!="undefined"?w.top:e.top,left:typeof w.left!="undefined"?w.left:e.left})};var U=function(b){a(G).unbind("resize");if(b){a(G).resize(function(){var d=K();a(P.overlay).css(d.page);a(P.lightpop).css(D(d,M()))})}};var K=function(){var w=(E?Q:T);var b=w.scrollWidth,e=w.scrollHeight,d=w.clientWidth,W=w.clientHeight;return{page:{width:(b<d?d:b),height:(e<W?W:e)},window:{width:d,height:W}}};var M=function(){var b=(Q&&Q.scrollTop?Q:T);return{left:b.scrollLeft,top:b.scrollTop}};var A=function(){h(a("object,embed",a(P.lightpop)),false).remove();a(P.lightpop).height(a(P.box).height()).slideUp(function(){a(this).remove();a(P.overlay).fadeOut(function(){a(this).remove();h(a("embed, object, select"),true)})});I(false);U(false);document.write=document._write};(function(){if(!l||(a.browser.version>6&&E)){return}var b=a(E?"html":"body");var d=b.css("background-image");if(d=="none"){b.css({"background-image":"url(null)"})}else{if(E){b.css({"background-image":"url(null)"});a("body").css({"background-image":d,"background-attachment":b.css("background-attachment")})}}b.css({"background-attachment":"fixed"})})();return L(this)}})(jQuery);